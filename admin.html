<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin | BasketStat</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèÄ</text></svg>">
  </head>
  <body>
    <header class="app-header">
      <div>
        <h1>Data Management</h1>
        <p>Upload, view, and edit game statistics</p>
      </div>
      <nav style="display: flex; gap: 12px;">
        <a href="bulk-import.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"/><line x1="16" x2="22" y1="5" y2="5"/><line x1="19" x2="19" y1="2" y2="8"/></svg>
          Bulk Import
        </a>
        <a href="reference-admin.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
          Benchmarks
        </a>
        <a href="index.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Dashboard
        </a>
      </nav>
    </header>

    <main class="app-shell admin-layout">
      <!-- Upload Section -->
      <section class="panel">
        <h2>Upload New Game</h2>
        <form id="uploadForm" class="upload-form">
          <div class="field">
            <label for="gameDate">Date</label>
            <input type="date" id="gameDate" required />
          </div>
          <div class="field">
            <label for="opponent">Opponent</label>
            <input type="text" id="opponent" placeholder="Team name" required />
          </div>
          <div class="field">
            <label for="league">League</label>
            <input type="text" id="league" placeholder="e.g. 1. divisjon, BLNO" required />
          </div>
          <div class="field">
            <label for="homeAway">Location</label>
            <select id="homeAway" required>
              <option value="">Select...</option>
              <option value="home">Home</option>
              <option value="away">Away</option>
            </select>
          </div>
          <div class="field">
            <label for="csvFile">Box Score CSV</label>
            <input type="file" id="csvFile" accept=".csv" required />
            <small>Format: player column (#number Name), plus stat columns</small>
          </div>
          <button type="submit">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
            Upload Game
          </button>
        </form>
        <div class="summary-card" id="uploadSummary">
          <p class="summary-label">Status</p>
          <h3 id="uploadStatus">Ready</h3>
          <p id="uploadDetails">Uploaded games appear below</p>
        </div>
      </section>

      <!-- Games List Section -->
      <section class="panel wide">
        <h2>Games</h2>
        <div class="data-table">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Opponent</th>
                <th>League</th>
                <th>H/A</th>
                <th>Players</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="gamesTable"></tbody>
          </table>
        </div>
        <div class="action-bar">
          <button id="exportData" class="secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Export JSON
          </button>
          <label class="button secondary" style="cursor: pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
            Import JSON
            <input type="file" id="importData" accept=".json" style="display: none;">
          </label>
          <button id="clearData" class="secondary danger">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            Clear All Data
          </button>
        </div>
      </section>

      <!-- Cloud Sync Section -->
      <section class="panel">
        <h2>‚òÅÔ∏è Cloud Sync</h2>
        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
          Shared cloud storage for all users. Configure in <code>config.js</code> and deploy.
        </p>
        
        <div id="cloudSyncStatus" class="cloud-sync-status">
          <div class="cloud-status-info">
            <span id="cloudStatusText">Checking configuration...</span>
          </div>
          <div class="cloud-sync-actions">
            <button id="cloudSyncUp" class="secondary" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17V3"/><path d="m6 11 6-8 6 8"/><path d="M19 21H5"/></svg>
              Upload to Cloud
            </button>
            <button id="cloudSyncDown" class="secondary" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v14"/><path d="m6 13 6 8 6-8"/><path d="M19 21H5"/></svg>
              Download from Cloud
            </button>
          </div>
        </div>
        
        <details style="margin-top: 16px;">
          <summary style="cursor: pointer; color: var(--text-secondary); font-size: 12px;">How to configure cloud sync</summary>
          <ol style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; padding-left: 20px;">
            <li>Create free account at <a href="https://jsonbin.io" target="_blank">jsonbin.io</a></li>
            <li>Get your API key from <a href="https://jsonbin.io/app/api-keys" target="_blank">API Keys page</a></li>
            <li>Edit <code>config.js</code> and add your <code>apiKey</code></li>
            <li>Upload data once, then copy the Bin ID to <code>config.js</code></li>
            <li>Deploy to GitHub Pages - all users will share the same data!</li>
          </ol>
        </details>
      </section>

      <!-- Player Registry Section -->
      <section class="panel">
        <h2>Player Registry</h2>
        <div class="data-table compact">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Games</th>
              </tr>
            </thead>
            <tbody id="playersTable"></tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Edit Game Modal -->
    <div class="modal-overlay" id="editGameModal">
      <div class="modal">
        <div class="modal-header">
          <h3>Edit Game</h3>
          <button class="modal-close" id="closeEditGame">&times;</button>
        </div>
        <form id="editGameForm" class="modal-body">
          <input type="hidden" id="editGameId" />
          <div class="field">
            <label for="editGameDate">Date</label>
            <input type="date" id="editGameDate" required />
          </div>
          <div class="field">
            <label for="editOpponent">Opponent</label>
            <input type="text" id="editOpponent" required />
          </div>
          <div class="field">
            <label for="editLeague">League</label>
            <input type="text" id="editLeague" required />
          </div>
          <div class="field">
            <label for="editHomeAway">Location</label>
            <select id="editHomeAway" required>
              <option value="home">Home</option>
              <option value="away">Away</option>
            </select>
          </div>
          <div class="modal-actions">
            <button type="button" class="secondary" id="cancelEditGame">Cancel</button>
            <button type="submit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View/Edit Stats Modal -->
    <div class="modal-overlay" id="statsModal">
      <div class="modal modal-wide">
        <div class="modal-header">
          <h3 id="statsModalTitle">Game Stats</h3>
          <button class="modal-close" id="closeStats">&times;</button>
        </div>
        <div class="modal-body">
          <div class="data-table">
            <table id="statsTable">
              <thead id="statsTableHead"></thead>
              <tbody id="statsTableBody"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="secondary" id="closeStatsBtn">Close</button>
        </div>
      </div>
    </div>

    <footer class="app-footer">
      <span>Data stored locally in browser storage</span>
    </footer>

    <script src="config.js"></script>
    <script src="data.js"></script>
    <script src="admin.js"></script>
  </body>
</html>
